---
title: "既存Pythonプロジェクトをuv管理へ移行する方法"
emoji: "🎉"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [python, uv]
published: false
---

# 記事概要

既存Pythonプロジェクトをuv管理へ移行する動機やその方法を記載します。

# よくある既存構成

既存Pythonプロジェクトはここではよくある以下の構成を想定とします。

| 管理対象         | 管理方法                       |
| ---------------- | ------------------------------ |
| Pythonバージョン | pyenv                          |
| 依存ライブラリ   | pip + requirements.txt         |
| 仮想環境         | pyenv-virtualenv もしくは venv |

モダンなパッケージマネージャーを使用していない場合のよくある構成かと思います。

# 上記のような構成の管理方法における課題

上記構成では以下のような課題がありそうです。
原因と、考えられる対応策も併記してみました。

| 課題                                                                                                                                                                           | 原因                                                                                                                  | 対応策                                                                                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| ライブラリインストール時に依存関係の解決に失敗しやすく、手動で調査と解決を強いられることがある                                                                                 | pipの依存関係解決アルゴリズムが比較的ナイーブ[^1]なため、全体で完全に整合性が取れる依存関係の構築が出来ないことがある | ・ より高度な依存関係アルゴリズムを持つツールを使用する<br> ・ エラーメッセージがわかりやすいツールを使用する |
| 依存の依存まで管理できないため、環境の完全再現が難しい（機械学習などにおいては特に環境はなるべく完全再現出来ることが望ましい）                                                 | requirements.txtは直接依存するライブラリを管理するのみのため[^2]                                                      | ・ lockファイルの仕組みを持つツールを使用する<br> ・ アプリケーションごとコンテナ化する                       |
| 手元で動かす際、仮想環境をactivateし忘れてpip installすると、グローバルにインストールされてしまうので、グローバル環境が汚染されやすい                                          | pyenv-virtualenvやvenv仮想環境は手動でactivateする必要があるため                                                      | ・ 意識せずとも仮想環境を使用出来るツールを使用する                                                           |
| 機能として必要な依存と開発に必要な依存を混ぜて管理しがちであり、環境の最小構成がしづらい、CIパイプラインを適切な粒度で分けづらい／壊れやすくなる、単純にわかりづらいなどがある | 全て単一のrequirements.txtに入れがちなため。                                                                          | ・ 分けて管理出来るツールを使用する                                                                           |

uvというPython開発環境管理ツールを使うと、上記課題は解決できます。
他にPoetryやPDMとも比較しましたが、今からなら最後発のuvで良いのかと思います。
uvの場合Pythonのバージョン管理まで出来るのでuv以外のツールは不要であることや、超高速に動作することなどにそれらと比較した強みがあります。
uvはver0系ではあるのですがステータスとしてはすでに[Stable](https://github.com/astral-sh/uv/issues/8941)とされており、個人的にもコア機能は既に安定しているのではないかと思っています。

[^1]: pipも強化されてきてはいるようですが

[^2]: `pip freeze > requirements.lockで` 一応lockファイルも作れるには作れますがまぁやらないですよね...
